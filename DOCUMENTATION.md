# ğŸ“˜ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© - Ø¯ÙˆÙƒÙ…Ù†ØªÙŠØ´Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø´Ø§Ù…Ù„Ø©

## ğŸ“‘ ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©](#Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©-Ø§Ù„ØªÙ‚Ù†ÙŠØ©)
3. [Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª](#Ù‚Ø§Ø¹Ø¯Ø©-Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
4. [Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù](#Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª-ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù)
5. [Ø§Ù„Ù€ APIs ÙˆØ§Ù„Ù€ Routes](#apis-routes)
6. [Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©](#Ù†Ø¸Ø§Ù…-Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
7. [Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª](#Ø§Ù„Ø¯ÙØ¹-ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª)
8. [Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ](#Ø§Ù„Ø´Ø§Øª-Ø¨ÙˆØª)
9. [Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©](#Ù„ÙˆØ­Ø©-Ø§Ù„ØªØ­ÙƒÙ…)
10. [Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª](#Ø§Ù„Ø¨ÙŠØ¦Ø©-ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
11. [Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªØ´ØºÙŠÙ„](#Ø§Ù„Ù†Ø´Ø±-ÙˆØ§Ù„ØªØ´ØºÙŠÙ„)
12. [Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡](#Ø§Ø³ØªÙƒØ´Ø§Ù-Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ {#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©}

### Ø§Ù„Ù‡Ø¯Ù

Ù…Ù†ØµØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© (Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠØŒ Ø¬ÙˆØ§Ø²Ø§Øª Ø§Ù„Ø³ÙØ±ØŒ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ØŒ Ø±Ø®Øµ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©ØŒ Ø¥Ù„Ø®) Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø³Ù„Ø³Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ Ø£Ùˆ Ø§Ù„Ù…ÙƒØªØ¨.

### Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©

**Frontend & Backend:**

- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **UI Components**: Custom Components Ù…Ø¹ Headless UI
- **Icons**: Heroicons Ùˆ Custom SVGs

**Database & ORM:**

- **Database**: PostgreSQL (Production) / SQLite (Development)
- **ORM**: Prisma ORM
- **Migrations**: Handled by Prisma

**Authentication:**

- **Library**: NextAuth.js v5 (Auth.js)
- **Providers**:
  - Credentials (Email/Password)
  - Google OAuth
- **Session**: JWT-based
- **Password Hashing**: bcrypt

**AI & Chatbot:**

- **Provider**: Google Gemini AI (2.0 Flash / 1.5 Pro)
- **Library**: @google/genai
- **Features**: Context-aware responses, Service recommendations

**Payment:**

- **Provider**: Paymob (Egypt)
- **Methods**: Card, Mobile Wallet, Cash on Delivery

**File Upload:**

- **Storage**: Local filesystem (`/public/uploads`)
- **Processing**: Sharp (if needed - not currently implemented)

**Notifications:**

- **WhatsApp**: Planned via WhatsApp Business API
- **In-app**: Custom notification system

---

## ğŸ—ï¸ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© {#Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©-Ø§Ù„ØªÙ‚Ù†ÙŠØ©}

### Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
web/
â”œâ”€â”€ prisma/                    # Database schema & migrations
â”‚   â”œâ”€â”€ schema.prisma         # Data models
â”‚   â”œâ”€â”€ migrations/           # Auto-generated migrations
â”‚   â””â”€â”€ seed-*.ts            # Seeding scripts
â”‚
â”œâ”€â”€ public/                   # Static assets
â”‚   â”œâ”€â”€ images/              # Product images
â”‚   â”œâ”€â”€ uploads/             # User uploaded files
â”‚   â””â”€â”€ icons/               # PWA icons
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/         # Auth routes (login, register)
â”‚   â”‚   â”œâ”€â”€ admin/          # Admin dashboard
â”‚   â”‚   â”œâ”€â”€ api/            # API routes
â”‚   â”‚   â”œâ”€â”€ checkout/       # Payment pages
â”‚   â”‚   â”œâ”€â”€ service/        # Service detail pages
â”‚   â”‚   â””â”€â”€ user/           # User profile pages
â”‚   â”‚
â”‚   â”œâ”€â”€ components/         # Reusable UI components
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                # Utility libraries
â”‚   â”‚   â”œâ”€â”€ auth.ts        # Auth helpers
â”‚   â”‚   â”œâ”€â”€ prisma.ts      # Prisma client
â”‚   â”‚   â”œâ”€â”€ logger.ts      # Logging utility
â”‚   â”‚   â””â”€â”€ ai-knowledge.ts # AI knowledge base
â”‚   â”‚
â”‚   â””â”€â”€ types/              # TypeScript type definitions
â”‚
â”œâ”€â”€ .env                    # Environment variables (local)
â”œâ”€â”€ .env.example           # Template for env vars
â”œâ”€â”€ next.config.js         # Next.js configuration
â”œâ”€â”€ tailwind.config.ts     # Tailwind CSS config
â””â”€â”€ tsconfig.json          # TypeScript config
```

### Ù…Ø¹Ù…Ø§Ø±ÙŠØ© App Router

```
src/app/
â”œâ”€â”€ page.tsx                    # Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
â”œâ”€â”€ layout.tsx                  # Layout Ø±Ø¦ÙŠØ³ÙŠ (Navbar, Footer)
â”‚
â”œâ”€â”€ (auth)/                     # Auth Group
â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”œâ”€â”€ register/page.tsx
â”‚   â””â”€â”€ layout.tsx             # Auth-specific layout
â”‚
â”œâ”€â”€ admin/                      # Admin Dashboard
â”‚   â”œâ”€â”€ layout.tsx             # Admin sidebar + auth guard
â”‚   â”œâ”€â”€ page.tsx               # Dashboard home
â”‚   â”œâ”€â”€ orders/                # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
â”‚   â”œâ”€â”€ services/              # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª
â”‚   â”œâ”€â”€ users/                 # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
â”‚   â”œâ”€â”€ promo-codes/          # Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…
â”‚   â”œâ”€â”€ create/                # Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
â”‚   â””â”€â”€ analytics/             # Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
â”‚
â”œâ”€â”€ service/[slug]/            # ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©
â”‚   â””â”€â”€ page.tsx
â”‚
â”œâ”€â”€ checkout/                  # ØµÙØ­Ø§Øª Ø§Ù„Ø¯ÙØ¹
â”‚   â”œâ”€â”€ page.tsx              # Checkout form
â”‚   â””â”€â”€ success/              # Payment success
â”‚
â””â”€â”€ api/                       # API Routes
    â”œâ”€â”€ auth/[...nextauth]/   # NextAuth endpoints
    â”œâ”€â”€ orders/               # Order CRUD
    â”œâ”€â”€ admin/                # Admin APIs
    â”œâ”€â”€ ai/chat/              # Chatbot endpoint
    â””â”€â”€ payments/             # Payment integration
```

---

## ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª {#Ù‚Ø§Ø¹Ø¯Ø©-Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª}

### Schema Overview

#### **User** - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

```prisma
model User {
  id                String    @id @default(cuid())
  name              String
  email             String?   @unique
  password          String?
  phone             String    @unique
  role              Role      @default(USER)

  // Personal Info
  birthDate         DateTime?
  fatherName        String?
  motherName        String?
  wifeName          String?
  idNumber          String?   @unique
  nationality       String?

  // Address
  address           String?
  governorate       String?
  city              String?
  district          String?
  street            String?
  buildingNumber    String?
  apartmentNumber   String?
  landmark          String?

  // Relations
  orders            Order[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

enum Role {
  USER
  ADMIN
}
```

#### **Service** - Ø§Ù„Ø®Ø¯Ù…Ø§Øª

```prisma
model Service {
  id          String            @id @default(cuid())
  name        String
  slug        String            @unique
  description String?
  category    ServiceCategory   @relation(fields: [categoryId], references: [id])
  categoryId  String

  // Features
  active      Boolean           @default(true)
  featured    Boolean           @default(false)

  // Relations
  variants    ServiceVariant[]
  documents   ServiceDocument[]
  fields      ServiceField[]    // Dynamic form fields
  orders      Order[]

  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}
```

#### **ServiceVariant** - Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø© (Ø¹Ø§Ø¯ÙŠ/Ù…Ø³ØªØ¹Ø¬Ù„)

```prisma
model ServiceVariant {
  id          String   @id @default(cuid())
  service     Service  @relation(fields: [serviceId], references: [id])
  serviceId   String

  name        String
  priceCents  Int      // Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ù‚Ø±ÙˆØ´
  etaDays     Int      // Ù…Ø¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
  active      Boolean  @default(true)

  orders      Order[]
}
```

#### **Order** - Ø§Ù„Ø·Ù„Ø¨Ø§Øª

```prisma
model Order {
  id                  String         @id @default(cuid())

  // Service Info
  service             Service        @relation(fields: [serviceId], references: [id])
  serviceId           String
  variant             ServiceVariant @relation(fields: [variantId], references: [id])
  variantId           String

  // User Info
  user                User?          @relation(fields: [userId], references: [id])
  userId              String?
  customerName        String
  customerPhone       String
  customerEmail       String?

  // Address
  address             String?
  governorate         String?
  city                String?
  deliveryType        String         @default("OFFICE")
  deliveryFee         Int            @default(0)

  // Pricing
  totalCents          Int
  discount            Int            @default(0)
  discountAmount      Int            @default(0)
  promoCode           PromoCode?     @relation(fields: [promoCodeId], references: [id])
  promoCodeId         String?

  // Status
  status              String         @default("PENDING")

  // Documents
  orderDocuments      OrderDocument[]

  // Admin
  createdByAdmin      User?          @relation("AdminCreatedOrders", fields: [createdByAdminId], references: [id])
  createdByAdminId    String?
  adminNotes          String?

  // Dynamic Fields (JSON)
  dynamicAnswers      Json?
  serviceDetails      String?

  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
}
```

#### **Payment** - Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª

```prisma
model Payment {
  id            String   @id @default(cuid())
  order         Order    @relation(fields: [orderId], references: [id])
  orderId       String

  amount        Int      // Ø¨Ø§Ù„Ù‚Ø±ÙˆØ´
  method        String   // CARD, WALLET, CASH
  status        String   // PENDING, CONFIRMED, FAILED

  // Paymob Integration
  paymobOrderId String?
  transactionId String?

  senderPhone   String?
  notes         String?

  createdAt     DateTime @default(now())
}
```

#### **PromoCode** - Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…

```prisma
model PromoCode {
  id              String    @id @default(cuid())
  code            String    @unique
  type            String    // FIXED or PERCENTAGE
  value           Int       // Ø§Ù„Ù‚ÙŠÙ…Ø© (Ù‚Ø±ÙˆØ´ Ù„Ù„Ù€ FIXED Ø£Ùˆ % Ù„Ù„Ù€ PERCENTAGE)

  // Limits
  usageLimit      Int?
  currentUsage    Int       @default(0)
  minOrderAmount  Int?      // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨
  maxDiscount     Int?      // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø®ØµÙ… (Ù„Ù„Ù€ PERCENTAGE)

  // Dates
  startDate       DateTime?
  endDate         DateTime?
  isActive        Boolean   @default(true)

  // Relations
  orders          Order[]

  createdAt       DateTime  @default(now())
}
```

### Database Commands

```bash
# Generate Prisma Client
npx prisma generate

# Create migration
npx prisma migrate dev --name migration_name

# Apply migrations (production)
npx prisma migrate deploy

# Seed database
npx prisma db seed

# Open Prisma Studio
npx prisma studio

# Reset database (CAUTION!)
npx prisma migrate reset
```

---

## âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù {#Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª-ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù}

### 1. Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

- **Hero Section** Ù…Ø¹ Call-to-Action
- **Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø§Øª** Ø¨Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
- **Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ù…Ù…ÙŠØ²Ø§Øª**
- **Footer** Ù…Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„

### 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø¯Ù…Ø§Øª

#### Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø®Ø¯Ù…Ø© (Admin):

- Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ÙˆØµÙ
- Ø§Ù„ØªØµÙ†ÙŠÙ (Category)
- **Variants**: Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© (Ø¹Ø§Ø¯ÙŠØŒ Ù…Ø³ØªØ¹Ø¬Ù„ØŒ VIP)
- **Dynamic Fields**: Ø£Ø³Ø¦Ù„Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© (Quiz) Ù„Ù„Ø¹Ù…ÙŠÙ„
- **Documents**: Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª)
- **Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„** (active/inactive)

#### Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø© (User):

- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ©
- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹ (Variant)
- Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
- Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
- Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ø±Ø¨Ø© Ø£Ùˆ Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±

### 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª

#### Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ (User):

1. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ù†ÙˆØ¹
2. Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
3. Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ (Ù…ÙƒØªØ¨/Ù…Ù†Ø²Ù„)
4. Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
5. Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
6. ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨

#### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Admin):

- Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ **ÙÙ„ØªØ±Ø© Ù…ØªÙ‚Ø¯Ù…Ø©**:
  - Ø§Ù„Ø¨Ø­Ø« (Ø§Ø³Ù…ØŒ Ø±Ù‚Ù…ØŒ Ø®Ø¯Ù…Ø©)
  - Ø§Ù„Ø­Ø§Ù„Ø© (pending, confirmed, in_progress, completed, cancelled)
  - Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù…Ù†/Ø¥Ù„Ù‰)
  - Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„
  - Ø§Ù„Ø®Ø¯Ù…Ø©
  - Ø§Ù„Ù…ØµØ¯Ø± (Ù…ÙƒØªØ¨/Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)
- **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©** (ÙØ±Ø¯ÙŠ Ø£Ùˆ Ø¬Ù…Ø§Ø¹ÙŠ)
- **Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„** Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø·Ù„Ø¨
- **Pagination** (10 Ø·Ù„Ø¨Ø§Øª/ØµÙØ­Ø©)

#### Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨:

```typescript
PENDING; // Ø¬Ø¯ÙŠØ¯ - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
CONFIRMED; // ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯
PAYMENT_CONFIRMED; // ØªÙ… Ø§Ù„Ø¯ÙØ¹
IN_PROGRESS; // Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°
READY; // Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…
COMPLETED; // ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
CANCELLED; // Ù…Ù„ØºÙŠ
PARTIAL_PAYMENT; // Ø¯ÙØ¹ Ø¬Ø²Ø¦ÙŠ
REFUNDED; // Ù…Ø³ØªØ±Ø¯
```

### 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹

#### Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹:

- **Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†** (Paymob)
- **Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©** (Paymob)
- **ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…**

#### ØªØ¯ÙÙ‚ Ø§Ù„Ø¯ÙØ¹:

1. Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ®ØªØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
2. Ø¥Ù†Ø´Ø§Ø¡ Payment Intent ÙÙŠ Paymob
3. Redirect Ù„Ù„Ù€ Payment Gateway
4. Callback Ù…Ù† Paymob
5. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨

### 5. Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª

#### Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®ØµÙ…:

- **FIXED**: Ù‚ÙŠÙ…Ø© Ø«Ø§Ø¨ØªØ© (Ù…Ø«Ù„Ø§Ù‹ 50 Ø¬Ù†ÙŠÙ‡)
- **PERCENTAGE**: Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ 10%)

#### Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†:

- **usageLimit**: Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
- **minOrderAmount**: Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨
- **maxDiscount**: Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø®ØµÙ… (Ù„Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©)
- **startDate/endDate**: ÙØªØ±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©

#### Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†:

```typescript
POST /api/promo-codes/validate
Body: { code: "LAUNCH25", orderTotal: 50000 }

Response: {
  valid: true,
  discountAmount: 5000,
  newTotal: 45000
}
```

### 6. Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª (AI)

#### Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:

- **Context-Aware**: ÙŠÙÙ‡Ù… Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
- **Service Recommendations**: ÙŠÙ‚ØªØ±Ø­ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
- **Order History**: ÙŠØ¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
- **Multi-Model Fallback**: ÙŠØ¬Ø±Ø¨ Ù†Ù…Ø§Ø°Ø¬ AI Ù…Ø®ØªÙ„ÙØ©

#### ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:

1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙƒØªØ¨ Ø³Ø¤Ø§Ù„
2. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¨Ù†ÙŠ Context Ù…Ù†:
   - Knowledge Base (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª)
   - User Profile (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡)
   - Conversation History
3. Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ Gemini AI
4. AI ÙŠØ±Ø¯ Ø¨Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø®ØµØµØ©

#### API:

```typescript
POST /api/ai/chat
Body: {
  message: "Ø¹Ø§ÙŠØ² Ø£Ø¬Ø¯Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
  userId: "...",
  isAuthenticated: true
}

Response: {
  success: true,
  response: "ØªÙ…Ø§Ù…! Ù‡Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†ØªÙ‡ÙŠØ© ÙˆÙ„Ø§ Ø¶Ø§Ø¹ØªØŸ...",
  source: "ai-v2"
}
```

### 7. Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©

#### Ø§Ù„ØµÙØ­Ø§Øª:

- **Dashboard**: Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§ØªØŒ Ø§Ù„Ø­Ø§Ù„Ø§Øª)
- **Orders**: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- **Services**: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª
- **Users**: Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- **Promo Codes**: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª
- **Create Order**: Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨
- **Analytics**: ØªÙ‚Ø§Ø±ÙŠØ± (Ù‚Ø±ÙŠØ¨Ø§Ù‹)

#### Ø§Ù„Ø­Ù…Ø§ÙŠØ©:

- ÙƒÙ„ ØµÙØ­Ø§Øª Admin Ù…Ø­Ù…ÙŠØ© Ø¨Ù€ `requireAuth()`
- ÙØ­Øµ `role === "ADMIN"`
- Redirect Ù„Ù„Ù€ Login Ø¥Ø°Ø§ ØºÙŠØ± Ù…ØµØ±Ø­

---

## ğŸ”Œ Ø§Ù„Ù€ APIs ÙˆØ§Ù„Ù€ Routes {#apis-routes}

### Public APIs

#### `GET /api/services`

Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©

```typescript
Response: {
  services: [
    {
      id: "...",
      name: "ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ",
      slug: "national-id-renewal",
      category: { name: "Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª" },
      variants: [...]
    }
  ]
}
```

#### `GET /api/services/[slug]`

ØªÙØ§ØµÙŠÙ„ Ø®Ø¯Ù…Ø© Ù…Ø¹ÙŠÙ†Ø©

```typescript
Response: {
  service: {
    id: "...",
    name: "...",
    description: "...",
    variants: [...],
    documents: [...],
    fields: [...]
  }
}
```

#### `POST /api/orders`

Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†)

```typescript
Body: {
  serviceId: "...",
  variantId: "...",
  customerName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  customerPhone: "01012345678",
  deliveryType: "HOME",
  address: "...",
  dynamicAnswers: { ... }
}

Response: {
  success: true,
  order: { ... }
}
```

#### `POST /api/promo-codes/validate`

Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…

```typescript
Body: { code: "LAUNCH25", orderTotal: 50000 }
Response: { valid: true, discountAmount: 5000, ... }
```

### Admin APIs

#### `GET /api/admin/orders`

Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø©

```typescript
Query Params:
  - userId
  - createdByAdminId
  - from (DD/MM/YYYY)
  - to (DD/MM/YYYY)
  - serviceIds[]
  - createdByAdmin (true/false)
  - page
  - limit

Response: {
  success: true,
  orders: [...],
  pagination: { page, limit, total, totalPages }
}
```

#### `POST /api/admin/orders`

Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨

```typescript
Body: {
  serviceId, variantId,
  customerName, customerPhone,
  workDate: "DD/MM/YYYY",  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„
  paidAmount, paymentMethod,
  ...
}
```

#### `PUT /api/admin/orders/[id]/status`

ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨

```typescript
Body: {
  status: 'CONFIRMED';
}
Response: {
  success: true;
}
```

#### `PUT /api/admin/orders/bulk-status`

ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¹Ø¯Ø© Ø·Ù„Ø¨Ø§Øª

```typescript
Body: {
  orderIds: ["id1", "id2", ...],
  status: "IN_PROGRESS"
}
```

#### `GET /api/admin/services`

Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª (Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)

#### `PUT /api/admin/services/[id]`

ØªØ­Ø¯ÙŠØ« Ø®Ø¯Ù…Ø©

```typescript
Body: {
  name, description, categoryId,
  variants: [...],
  documents: [...],
  fields: [...]
}
```

#### `GET /api/admin/promo-codes`

Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª

#### `POST /api/admin/promo-codes`

Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯

#### `DELETE /api/admin/promo-codes/[id]`

Ø­Ø°Ù/Ø¥ÙŠÙ‚Ø§Ù ÙƒÙˆØ¨ÙˆÙ†

### AI API

#### `POST /api/ai/chat`

Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø´Ø§Øª Ø¨ÙˆØª

```typescript
Body: {
  message: "...",
  userId?: "...",
  isAuthenticated?: boolean,
  currentPath?: "/"
}

Response: {
  success: true,
  response: "...",
  source: "ai-v2"
}
```

---

## ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© {#Ù†Ø¸Ø§Ù…-Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©}

### NextAuth.js Configuration

Ø§Ù„Ù…Ù„Ù: `auth.config.ts`

```typescript
export const authConfig = {
  providers: [
    CredentialsProvider({
      async authorize(credentials) {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù€ email/phone
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù€ bcrypt
        // Ø¥Ø±Ø¬Ø§Ø¹ user object
      },
    }),
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  callbacks: {
    jwt({ token, user }) {
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ JWT
      if (user) {
        token.id = user.id;
        token.role = user.role;
      }
      return token;
    },
    session({ session, token }) {
      // Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† JWT Ù„Ù„Ù€ session
      session.user.id = token.id;
      session.user.role = token.role;
      return session;
    },
  },
  pages: {
    signIn: '/login',
    error: '/login',
  },
};
```

### Helper Functions

Ø§Ù„Ù…Ù„Ù: `src/lib/auth.ts`

```typescript
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
export async function requireAuth() {
  const session = await getServerSession(authConfig);
  if (!session) {
    redirect('/login');
  }
  return session;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Admin
export async function requireAdmin() {
  const session = await requireAuth();
  if (session.user.role !== 'ADMIN') {
    throw new Error('Unauthorized');
  }
  return session;
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„
export function getWorkDate(session) {
  // Ù„Ù„Ù€ Admins ÙŠÙ…ÙƒÙ†Ù‡Ù… ØªØ®ØµÙŠØµ Ø§Ù„ØªØ§Ø±ÙŠØ®
  // Ù„Ù„Ù€ Users ÙŠÙƒÙˆÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
}
```

### Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª

```typescript
// Server Component
export default async function AdminPage() {
  const session = await requireAuth();
  if (session.user.role !== 'ADMIN') redirect('/');

  // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯...
}

// API Route
export async function GET(request) {
  const session = await requireAuth();

  if (session.user.role !== 'ADMIN') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 403 });
  }

  // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯...
}
```

---

## ğŸ’³ Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª {#Ø§Ù„Ø¯ÙØ¹-ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª}

### ØªÙƒØ§Ù…Ù„ Paymob

#### Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:

```env
PAYMOB_API_KEY=your_key
PAYMOB_SECRET_KEY=your_secret
PAYMOB_INTEGRATION_ID_CARD=123456
PAYMOB_INTEGRATION_ID_WALLET=789012
```

#### ØªØ¯ÙÙ‚ Ø§Ù„Ø¯ÙØ¹:

1. **Ø¥Ù†Ø´Ø§Ø¡ Order ÙÙŠ Paymob:**

```typescript
const paymobOrder = await fetch('https://accept.paymob.com/api/ecommerce/orders', {
  method: 'POST',
  body: JSON.stringify({
    auth_token: token,
    amount_cents: totalCents,
    currency: 'EGP',
    items: [...]
  })
});
```

2. **Ø¥Ù†Ø´Ø§Ø¡ Payment Key:**

```typescript
const paymentKey = await fetch('https://accept.paymob.com/api/acceptance/payment_keys', {
  method: 'POST',
  body: JSON.stringify({
    auth_token: token,
    amount_cents: totalCents,
    order_id: paymobOrder.id,
    billing_data: { ... },
    integration_id: INTEGRATION_ID
  })
});
```

3. **Redirect Ù„Ù„Ù€ iFrame:**

```typescript
window.location.href = `https://accept.paymob.com/api/acceptance/iframes/${IFRAME_ID}?payment_token=${paymentKey.token}`;
```

4. **Callback Handler:**

```typescript
POST / api / payments / callback;

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† HMAC signature
// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
// Redirect Ù„Ù„Ù€ success page
```

### Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª

```typescript
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
const promo = await prisma.promoCode.findUnique({ where: { code } });

if (!promo.isActive) throw new Error('ØºÙŠØ± ÙØ¹Ø§Ù„');
if (promo.endDate && new Date() > promo.endDate) throw new Error('Ù…Ù†ØªÙ‡ÙŠ');
if (promo.usageLimit && promo.currentUsage >= promo.usageLimit) throw new Error('ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
if (promo.minOrderAmount && orderTotal < promo.minOrderAmount) throw new Error('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰...');

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ…
let discount = 0;
if (promo.type === 'FIXED') {
  discount = promo.value;
} else {
  discount = Math.round((orderTotal * promo.value) / 100);
  if (promo.maxDiscount && discount > promo.maxDiscount) {
    discount = promo.maxDiscount;
  }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
await prisma.promoCode.update({
  where: { id: promo.id },
  data: { currentUsage: { increment: 1 } },
});
```

---

## ğŸ¤– Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ {#Ø§Ù„Ø´Ø§Øª-Ø¨ÙˆØª}

### Ù…Ø¹Ù…Ø§Ø±ÙŠØ© AI Service

Ø§Ù„Ù…Ù„Ù: `src/app/api/ai/chat/route.ts`

```typescript
// Context Builder
class ContextBuilder {
  static async build(request) {
    const [businessData, userData] = await Promise.all([
      this.getBusinessData(), // Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù† DB
      this.getUserData(request), // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    ]);

    return `
      SYSTEM PROMPT + PERSONALITY
      BUSINESS DATA (Services, Prices, Documents)
      USER DATA (Name, Orders)
      CONVERSATION HISTORY
    `;
  }

  static async getBusinessData() {
    const services = await prisma.service.findMany({
      include: { variants, documents, fields },
    });

    // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ formatted text Ù„Ù„Ù€ AI
    return services
      .map(
        s => `
      SERVICE: ${s.name}
      SLUG: /service/${s.slug}
      VARIANTS: ...
      DOCUMENTS: ...
    `
      )
      .join('\n');
  }
}

// Gemini Service
class GeminiService {
  static async generate(prompt) {
    // Multi-model fallback
    for (const model of ['gemini-2.0-flash', 'gemini-1.5-pro']) {
      try {
        const response = await ai.models.generateContent({
          model,
          contents: [{ role: 'user', parts: [{ text: prompt }] }],
          config: { temperature: 0.7, maxOutputTokens: 2048 },
        });

        return response.text;
      } catch (e) {
        // Try next model
      }
    }
  }
}
```

### System Prompt

```
Ø£Ù†Øª **Ø£Ø­Ù…Ø¯**ØŒ Ù…ÙˆØ¸Ù Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø´Ø±ÙƒØ© "Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©".

Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:
1. ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙˆÙ…ØµØ±ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨
2. Ø§Ø³Ø£Ù„ Ø£Ø³Ø¦Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„
3. Ù„Ø§ ØªØ¹Ø·ÙŠ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
4. Ø§Ø³ØªØ®Ø¯Ù… Ø±ÙˆØ§Ø¨Ø· ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø®Ø¯Ù…Ø§Øª
5. NEVER invent service slugs

Ù…Ø«Ø§Ù„ Ù„Ù„ØªÙØ§Ø¹Ù„:
User: "Ø¹Ø§ÙŠØ² Ø£Ø¬Ø¯Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©"
Ahmed: "Ù…Ù† Ø¹ÙŠÙˆÙ†ÙŠ! Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†ØªÙ‡ÙŠØ© ÙˆÙ„Ø§ Ø¶Ø§Ø¹Øª Ù…Ù†ÙƒØŸ"
```

### Session Management

```typescript
const sessionStore = new Map<string, UserSession>();

interface UserSession {
  history: string[]; // Ø¢Ø®Ø± 20 Ø±Ø³Ø§Ù„Ø©
  lastAccess: number;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ history
ContextBuilder.updateHistory(request, userMsg, aiMsg);
```

---

## ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© {#Ù„ÙˆØ­Ø©-Ø§Ù„ØªØ­ÙƒÙ…}

### Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

#### 1. Dashboard (`/admin`)

- **Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…**: Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
- **Quick Stats**: Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
- **Recent Orders**: Ø¢Ø®Ø± 5 Ø·Ù„Ø¨Ø§Øª

#### 2. Orders (`/admin/orders`)

- **Filters**:
  - Search bar (Ø§Ø³Ù…ØŒ Ø±Ù‚Ù…ØŒ Ø®Ø¯Ù…Ø©)
  - Status dropdown
  - Date range (Ù…Ù†/Ø¥Ù„Ù‰)
  - Service multi-select
  - Delivery type
  - Order source (Ù…ÙƒØªØ¨/Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)
- **Bulk Actions**: ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¹Ø¯Ø© Ø·Ù„Ø¨Ø§Øª
- **Pagination**: 10 per page
- **Order Details Modal**

#### 3. Services (`/admin/services`)

- **List View**: ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
- **Edit**: ØªØ¹Ø¯ÙŠÙ„ Ø®Ø¯Ù…Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
- **Components**:
  - Basic Info (name, description, category)
  - Variants Manager
  - Documents Manager
  - Dynamic Fields (Quiz)

#### 4. Create Order (`/admin/create`)

- **Multi-Step Form**:
  1. Service Selection
  2. Customer Info
  3. Personal Details
  4. Documents Upload
  5. Payment & Notes
- **Features**:
  - Auto-complete Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
  - Form serial validation
  - Work date override
  - Instant payment recording

#### 5. Promo Codes (`/admin/promo-codes`)

- **List**: ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª
- **Create/Edit Modal**
- **Stats**: Usage count
- **Status**: Active/Inactive/Expired

### Custom Hooks

#### `useOrders`

```typescript
export function useOrders(showSuccess, showError) {
  const [orders, setOrders] = useState([]);
  const [filters, setFilters] = useState({ ... });

  // Fetch with filters
  const fetchOrders = useCallback(async () => {
    const params = new URLSearchParams();
    if (filters.dateFrom) params.set('from', filters.dateFrom);
    // ...

    const response = await fetch(`/api/admin/orders?${params}`);
    setOrders(response.orders);
  }, [filters]);

  // Update status
  const updateOrderStatus = async (orderId, status) => {
    await fetch(`/api/admin/orders/${orderId}/status`, {
      method: 'PUT',
      body: JSON.stringify({ status })
    });

    fetchOrders();
    showSuccess("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!");
  };

  return { orders, filters, updateOrderStatus, ... };
}
```

#### `useCreateOrder`

```typescript
export function useCreateOrder() {
  const [formData, setFormData] = useState({ ... });
  const [selectedService, setSelectedService] = useState(null);

  // Calculate total
  const calculateTotal = () => {
    let total = selectedVariant.priceCents;
    total += deliveryFee;
    total -= discount;
    total -= promoDiscount;
    return Math.max(0, total);
  };

  // Submit order
  const handleSubmit = async () => {
    const response = await fetch('/api/admin/orders', {
      method: 'POST',
      body: JSON.stringify({ ...formData })
    });

    if (response.ok) {
      showSuccess("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨!");
      router.push('/admin/orders');
    }
  };

  return { formData, setFormData, handleSubmit, ... };
}
```

---

## âš™ï¸ Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª {#Ø§Ù„Ø¨ÙŠØ¦Ø©-ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª}

### Ù…Ù„Ù `.env`

```env
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/ofa_db"

# NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-super-secret-key-here"

# Google OAuth
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# Google AI
GOOGLE_API_KEY="your-gemini-api-key"

# Paymob
PAYMOB_API_KEY="your-paymob-key"
PAYMOB_SECRET_KEY="your-paymob-secret"
PAYMOB_INTEGRATION_ID_CARD="123456"
PAYMOB_INTEGRATION_ID_WALLET="789012"
PAYMOB_IFRAME_ID="12345"

# WhatsApp (Optional)
WHATSAPP_API_TOKEN="your-whatsapp-token"
WHATSAPP_PHONE_NUMBER_ID="your-phone-id"

# App Settings
NODE_ENV="development"
```

### Ù…Ù„Ù `next.config.js`

```javascript
const nextConfig = {
  images: {
    domains: ['localhost', 'your-domain.com'],
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.googleusercontent.com',
      },
    ],
  },
  experimental: {
    serverActions: true,
  },
};
```

### Ù…Ù„Ù `tailwind.config.ts`

```typescript
const config = {
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: {...},
        secondary: {...}
      },
      fontFamily: {
        cairo: ['Cairo', 'sans-serif']
      }
    }
  }
};
```

---

## ğŸš€ Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ {#Ø§Ù„Ù†Ø´Ø±-ÙˆØ§Ù„ØªØ´ØºÙŠÙ„}

### Local Development

```bash
# 1. Install dependencies
npm install

# 2. Setup database
npx prisma generate
npx prisma migrate dev
npx prisma db seed

# 3. Run dev server
npm run dev

# 4. Open browser
# http://localhost:3000
```

### Production Build

```bash
# 1. Build
npm run build

# 2. Start production server
npm start
```

### Docker Deployment (Optional)

```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY prisma ./prisma
RUN npx prisma generate

COPY . .
RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

```bash
# Build image
docker build -t ofa-web .

# Run container
docker run -p 3000:3000 \
  -e DATABASE_URL="..." \
  -e NEXTAUTH_SECRET="..." \
  ofa-web
```

### Vercel Deployment

```bash
# 1. Install Vercel CLI
npm i -g vercel

# 2. Deploy
vercel

# 3. Add environment variables in Vercel Dashboard
# 4. Prisma: Add postbuild script

# package.json
{
  "scripts": {
    "postbuild": "prisma generate"
  }
}
```

### Database Migration (Production)

```bash
# Apply migrations
npx prisma migrate deploy

# OR reset (CAUTION!)
npx prisma migrate reset --force
```

---

## ğŸ”§ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ {#Ø§Ø³ØªÙƒØ´Ø§Ù-Ø§Ù„Ø£Ø®Ø·Ø§Ø¡}

### Ù…Ø´Ø§ÙƒÙ„ Ø´Ø§Ø¦Ø¹Ø© ÙˆØ­Ù„ÙˆÙ„Ù‡Ø§

#### 1. Build Errors

**Ø®Ø·Ø£:** `Type error: Object is possibly 'undefined'`

```typescript
// âŒ Wrong
const newV = [...variants];
newV[i].name = value;

// âœ… Correct
setVariants(prev => prev.map((v, idx) => (idx === i ? { ...v, name: value } : v)));
```

**Ø®Ø·Ø£:** `Module not found: Can't resolve '@/...'`

```bash
# Ø­Ù„: ØªØ£ÙƒØ¯ Ù…Ù† tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

#### 2. Database Issues

**Ø®Ø·Ø£:** `Prisma Client initialization error`

```bash
# Ø­Ù„
npx prisma generate
npm run dev
```

**Ø®Ø·Ø£:** `Migration failed`

```bash
# Ø­Ù„: Reset ÙÙŠ Development
npx prisma migrate reset

# Production: Fix manually or rollback
```

#### 3. Authentication Errors

**Ø®Ø·Ø£:** `Invalid session`

```typescript
// ØªØ£ÙƒØ¯ Ù…Ù†:
1. NEXTAUTH_SECRET Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ .env
2. NEXTAUTH_URL ØµØ­ÙŠØ­
3. Cookies enabled ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
```

**Ø®Ø·Ø£:** `Credentials signin error`

```typescript
// ØªØ­Ù‚Ù‚ Ù…Ù†:
1. Ø§Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ù‡Ø§ØªÙ ØµØ­ÙŠØ­
2. bcrypt.compare ÙŠØ¹Ù…Ù„
3. User Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ DB
```

#### 4. AI Chatbot Issues

**Ø®Ø·Ø£:** `All AI models failed`

```typescript
// Ø£Ø³Ø¨Ø§Ø¨ Ù…Ø­ØªÙ…Ù„Ø©:
1. GOOGLE_API_KEY ØºÙŠØ± ØµØ­ÙŠØ­
2. Quota exceeded
3. Network issue

// Ø­Ù„
- ØªØ­Ù‚Ù‚ Ù…Ù† API Key
- Ø¬Ø±Ø¨ model ÙˆØ§Ø­Ø¯ Ø£ÙˆÙ„Ø§Ù‹
```

#### 5. Payment Issues

**Ø®Ø·Ø£:** `Paymob authentication failed`

```bash
# ØªØ­Ù‚Ù‚ Ù…Ù†:
1. PAYMOB_API_KEY
2. PAYMOB_SECRET_KEY
3. Network connection
```

**Ø®Ø·Ø£:** `HMAC verification failed`

```typescript
// ØªØ£ÙƒØ¯ Ù…Ù†:
1. Secret key ØµØ­ÙŠØ­
2. Callback URL Ù…Ù†Ø§Ø³Ø¨
3. Request body ÙƒØ§Ù…Ù„
```

### Logging & Debugging

```typescript
// Ø§Ø³ØªØ®Ø¯Ù… logger Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† console
import { logger } from '@/lib/logger';

logger.info('User logged in', { userId: user.id });
logger.error('Payment failed', error);
logger.warn('Low stock', { productId });
```

### Performance Optimization

```typescript
// 1. Database Queries
// âŒ N+1 Problem
for (const order of orders) {
  const service = await prisma.service.findUnique({
    where: { id: order.serviceId }
  });
}

// âœ… Include relation
const orders = await prisma.order.findMany({
  include: { service: true }
});

// 2. Image Optimization
// âœ… Use Next.js Image
import Image from 'next/image';

<Image
  src="/image.jpg"
  width={500}
  height={300}
  alt="..."
/>
```

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©

### Security Best Practices

1. âœ… Ø§Ø³ØªØ®Ø¯Ù… Environment Variables Ù„Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø³Ø±ÙŠØ©
2. âœ… Hash ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù€ bcrypt
3. âœ… Validate ÙƒÙ„ Ø§Ù„Ù€ inputs
4. âœ… Ø§Ø³ØªØ®Ø¯Ù… HTTPS ÙÙŠ Production
5. âœ… Rate limiting Ù„Ù„Ù€ APIs
6. âœ… CSRF protection (NextAuth handles this)

### Code Quality

1. âœ… TypeScript strict mode
2. âœ… ESLint + Prettier
3. âœ… Consistent naming conventions
4. âœ… Error handling ÙÙŠ ÙƒÙ„ API
5. âœ… Logging Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‡Ù…Ø©
